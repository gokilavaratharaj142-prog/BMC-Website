<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin ‚Äî Best Marketing Company</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
<script>window.API_BASE="http://localhost:5000";</script>
<style>
:root{--bg:#F9F5EB;--surface:#FFFFFF;--text:#3E2723;--text-light:#6D4C41;--accent:#8D6E63;--accent-dark:#4E342E;--border:rgba(62,39,35,0.08);--radius:8px}
:root[data-theme="dark"]{--bg:#121212;--surface:#1a1a1a;--text:#f5f5f5;--text-light:#c7bdb7;--accent:#b08968;--accent-dark:#7f5539;--border:rgba(255,255,255,0.08)}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Manrope',sans-serif;overflow-x:hidden}
a{color:inherit;text-decoration:none}
a:visited{color:inherit}
.topbar{position:fixed;top:0;left:0;width:100%;background:#2C1810;color:#F9F5EB;padding:8px 0;font-size:12px;z-index:1001}
.topbar-inner{max-width:1200px;margin:0 auto;padding:0 40px;display:flex;justify-content:space-between;align-items:center}
.topbar a{opacity:.8;transition:opacity .2s}
.topbar a:hover{opacity:1}
.main-nav{position:fixed;top:40px;left:0;width:100%;padding:20px 40px;display:flex;justify-content:space-between;align-items:center;z-index:1000;background:rgba(249,245,235,.9);backdrop-filter:blur(10px);box-shadow:0 4px 20px rgba(62,39,35,.05);transition:all .4s cubic-bezier(0.16,1,0.3,1)}
.main-nav.scrolled{background:rgba(249,245,235,.95)}
:root[data-theme="dark"] .main-nav{background:rgba(26,26,26,.90)}
:root[data-theme="dark"] .main-nav.scrolled{background:rgba(26,26,26,.95)}
.brand{font-weight:900;font-size:24px;letter-spacing:-0.04em;color:var(--text)}
.nav-links{display:flex;gap:40px}
.nav-links a{font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.05em;position:relative;color:var(--text)}
.nav-links a::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:var(--accent);transition:width .3s cubic-bezier(0.65,0,0.35,1)}
.nav-links a:hover::after{width:100%}
.nav-btn{padding:12px 24px;background:var(--text);color:var(--bg);font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:0.05em;border-radius:8px;transition:all .3s}
.nav-btn{padding:12px 24px;background:var(--accent);color:#fff;font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:0.05em;border-radius:8px;transition:transform .2s, box-shadow .2s;border:1px solid var(--accent-dark)}
.nav-btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(62,39,35,.12)}
.dropdown{position:relative}
.dropdown > a{display:flex;align-items:center;gap:6px}
.dropdown-content{position:absolute;top:28px;left:0;min-width:260px;background:rgba(255,255,255,.95);border:1px solid var(--border);border-radius:10px;box-shadow:0 20px 40px rgba(0,0,0,.08);padding:12px;display:none}
.dropdown-content a{display:block;padding:10px 12px;font-size:12px;letter-spacing:.06em;text-transform:uppercase;color:var(--text);border-radius:8px}
.dropdown-content a:hover{background:var(--bg)}
.dropdown:hover .dropdown-content{display:block}
.page-hero{min-height:50vh;padding:140px 5vw 40px;display:flex;flex-direction:column;justify-content:flex-end;border-bottom:1px solid var(--border)}
.hero-title{font-size:clamp(40px,7vw,80px);margin-bottom:10px;background:linear-gradient(to right,var(--text),var(--text-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero-desc{max-width:900px;font-size:18px;color:var(--text-light);line-height:1.8;border-left:2px solid var(--accent);padding-left:24px}
.wrap{max-width:1200px;margin:0 auto;padding:60px 5vw}
.tabs{display:flex;gap:12px;margin-bottom:20px}
.tab{padding:10px 16px;border:1px solid var(--border);border-radius:999px;background:var(--surface);cursor:pointer;font-size:12px;text-transform:uppercase;font-weight:700}
.tab.active{background:var(--accent);color:white;border-color:var(--accent)}
.tools{display:flex;gap:12px;margin:12px 0 24px}
.btn{padding:10px 16px;border-radius:8px;border:1px solid var(--accent);background:var(--accent);color:white;cursor:pointer;font-weight:700;font-size:12px;text-transform:uppercase}
.btn.secondary{background:transparent;color:var(--text);border-color:var(--text)}
.table{width:100%;border-collapse:collapse;border:1px solid var(--border);background:var(--surface)}
.table th,.table td{border-bottom:1px solid var(--border);padding:10px 12px;font-size:14px;text-align:left}
.empty{padding:12px 16px;border:1px dashed var(--border);border-radius:8px;color:var(--text-light)}
@media(max-width:900px){.table{display:block;overflow:auto}}
</style>
</head>
<body>
<div id="loginGate" style="position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:2000">
  <div style="width:360px;background:var(--surface);border:1px solid var(--border);border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,.08);padding:24px">
    <div style="font-weight:900;font-size:22px;margin-bottom:6px;color:var(--text)">Admin Login</div>
    <div style="color:var(--text-light);font-size:14px;margin-bottom:18px">Only authorized personnel may proceed.</div>
    <div style="display:flex;flex-direction:column;gap:10px">
      <input id="admUser" placeholder="Username" style="padding:12px;border:1px solid var(--border);border-radius:8px">
      <input id="admPass" placeholder="Password" type="password" style="padding:12px;border:1px solid var(--border);border-radius:8px">
      <button id="admLoginBtn" style="padding:12px;border-radius:8px;border:1px solid var(--accent);background:var(--accent);color:#fff;font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:.06em">Login</button>
      <div id="admError" style="display:none;color:#b00020;font-size:13px">Invalid credentials</div>
    </div>
  </div>
</div>
<div class="topbar">
  <div class="topbar-inner">
    <div>BMC Share: ‚Çπ281.40 (-0.03)</div>
    <div style="display:flex;gap:20px;">
      <a href="#">Careers</a>
      <a href="#">News</a>
      <a href="#">Global (EN)</a>
    </div>
  </div>
</div>
<nav class="main-nav">
  <a class="brand" href="bmc original maari.html#top">Best Marketing Company</a>
  <div class="nav-links">
    <a href="bmc original maari.html#top">Home</a>
    <div class="dropdown">
      <a href="about.html">About Us ‚ñæ</a>
      <div class="dropdown-content">
        <a href="company-profile.html">Company Profile</a>
        <a href="awards.html">Awards & Recognitions</a>
        <a href="memberships.html">Memberships & Affiliations</a>
      </div>
    </div>
    <div class="dropdown">
      <a href="bmc original maari.html#categories">Our Products ‚ñæ</a>
      <div class="dropdown-content">
        <a href="valves.html">Valves</a>
        <a href="crucibles.html">Crucibles</a>
        <a href="foundry-products.html">Foundry Products</a>
        <a href="coolants-lubricants.html">Coolants & Lubricants</a>
        <a href="die-casting.html">Die Casting Machines</a>
        <a href="foundry-automations.html">BMC Automation & Solutions</a>
        <a href="vacuum-casting.html">Vacuum Casting Systems</a>
      </div>
    </div>
    <a href="media.html">Media</a>
    <a href="bmc original maari.html#contact">Contact</a>
    <a href="feedback.html">Feedback</a>
    <a href="admin.html">Admin</a>
  </div>
  <button id="themeToggle" class="nav-btn" style="background:transparent;color:var(--text);border:1px solid var(--text)">Dark Mode</button>
  <a href="bmc original maari.html#contact" class="nav-btn">Get Quote</a>
</nav>
<div id="adminApp" style="display:none">
<header class="page-hero">
  <h1 class="hero-title">Admin Dashboard</h1>
  <div class="hero-desc">View and export website submissions. Data is stored in the browser for privacy. Use Export CSV to download records. <span id="backendStatus" style="margin-left:6px;color:var(--accent);font-weight:700"></span></div>
</header>
<section class="wrap">
  <div class="tabs">
    <button class="tab active" data-tab="contacts">Contacts</button>
    <button class="tab" data-tab="feedback">Feedback</button>
  </div>
  <div class="tools">
    <button class="btn" id="exportBtn">Export CSV</button>
    <button class="btn secondary" id="clearBtn">Clear Records</button>
    <button class="btn secondary" id="logoutBtn">Logout</button>
  </div>
  <div id="tableWrap"></div>
  <div id="charts" style="margin-top:24px"></div>
</section>
<script>
const CONTACT_KEY = 'bmc_contacts';
const FEEDBACK_KEY = 'bmc_feedback';
let current = 'contacts';
const ADM_KEY = 'bmc_admin_auth';
const Backend = {
  base: (window.API_BASE || window.FUNCTIONS_BASE_URL || ''),
  enabled(){ return !!this.base },
  async login(u,p){
    if(!this.enabled()) return {ok:false};
    const res = await fetch(`${this.base}/api/admin/login`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({username:u, password:p})}).catch(()=>null);
    if(!res || !res.ok) return {ok:false};
    localStorage.setItem(ADM_KEY,'yes');
    return {ok:true};
  },
  async get(path){
    if(!this.enabled()) return null;
    const res = await fetch(`${this.base}${path}`).catch(()=>null);
    if(!res || !res.ok) return null;
    return res.json().catch(()=>null);
  }
};
function isAuthed(){ return localStorage.getItem(ADM_KEY)==='yes' }
function tryLogin(u,p){
  const ok = (u==='BMCAdmin') && (p==='BMC@2025');
  if(ok){ localStorage.setItem(ADM_KEY,'yes'); return true }
  return false;
}
function gate(){
  const gate = document.getElementById('loginGate');
  const app = document.getElementById('adminApp');
  if(isAuthed()){ gate.style.display='none'; app.style.display='block'; return }
  gate.style.display='flex'; app.style.display='none';
  document.getElementById('admLoginBtn').addEventListener('click', async ()=>{
    const u = document.getElementById('admUser').value.trim();
    const p = document.getElementById('admPass').value.trim();
    if(Backend.enabled()){
      const ok = await Backend.login(u,p);
      if(ok.ok){ gate.style.display='none'; app.style.display='block' }
      else if(tryLogin(u,p)){ gate.style.display='none'; app.style.display='block' }
      else { const e=document.getElementById('admError'); e.style.display='block' }
    }else{
      if(tryLogin(u,p)){ gate.style.display='none'; app.style.display='block' }
      else { const e=document.getElementById('admError'); e.style.display='block' }
    }
  });
}
function getData(key){ try{ return JSON.parse(localStorage.getItem(key))||[] }catch(e){ return [] } }
function toCSV(rows){
  if(!rows.length) return '';
  const header = Object.keys(rows[0]);
  const escape = v => `"${String(v).replace(/"/g,'""')}"`;
  const lines = [header.join(',')].concat(rows.map(r=>header.map(h=>escape(r[h]??'')).join(',')));
  return lines.join('\r\n');
}
async function drawCharts(){
  const wrap = document.getElementById('charts');
  if(current!=='feedback'){ wrap.innerHTML=''; return }
  let data = getData(FEEDBACK_KEY);
  if(Backend.enabled()){
    const remote = await Backend.get('/api/feedback');
    if(Array.isArray(remote) && remote.length) data = remote;
  }
  if(!data.length){ wrap.innerHTML=''; return }
  const catCounts = {};
  const rateCounts = {'5 - Excellent':0,'4 - Good':0,'3 - Average':0,'2 - Poor':0,'1 - Very Poor':0};
  data.forEach(d=>{
    const c = d.category||'Other';
    catCounts[c] = (catCounts[c]||0)+1;
    const r = d.rating||'';
    if(rateCounts[r]!=null) rateCounts[r]++; 
  });
  const maxCat = Math.max(...Object.values(catCounts));
  const maxRate = Math.max(...Object.values(rateCounts));
  const good = data.filter(d=>{
    const r = d.rating||'';
    const s = Number(d.stars||0);
    return r.startsWith('5') || r.startsWith('4') || s>=4 || d.sentiment==='love' || d.sentiment==='like';
  }).length;
  const sat = Math.round((good/data.length)*100);
  const bar = (label,val,max)=>`<div style="display:flex;align-items:center;gap:12px;margin:6px 0"><div style="width:180px;font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:.06em;color:var(--accent)">${label}</div><div style="flex:1;height:10px;background:#f0ede6;border-radius:999px;overflow:hidden"><div style="width:${Math.round((val/max)*100)}%;height:10px;background:var(--accent);transition:width .3s"></div></div><div style="width:40px;text-align:right;color:var(--text-light)">${val}</div></div>`;
  const cats = Object.entries(catCounts).map(([k,v])=>bar(k,v,maxCat)).join('');
  const rates = Object.entries(rateCounts).map(([k,v])=>bar(k,v,maxRate)).join('');
  let monthBars = '';
  if(Backend.enabled()){
    const stats = await Backend.get('/api/admin/analytics/leads');
    if(Array.isArray(stats) && stats.length){
      const entries = stats.slice(-6);
      const maxMonth = Math.max(...entries.map(e=>e.total));
      monthBars = entries.map(e=>bar(e.day, e.total, Math.max(1,maxMonth))).join('');
    }else{
      const months = {};
      data.forEach(d=>{
        const dt = new Date(d.timestamp||Date.now());
        const key = dt.toISOString().slice(0,7);
        months[key] = (months[key]||0)+1;
      });
      const maxMonth = Math.max(...Object.values(months));
      monthBars = Object.entries(months).slice(-6).map(([k,v])=>bar(k,v,Math.max(1,maxMonth))).join('');
    }
  }else{
    const months = {};
    data.forEach(d=>{
      const dt = new Date(d.timestamp||Date.now());
      const key = dt.toISOString().slice(0,7);
      months[key] = (months[key]||0)+1;
    });
    const maxMonth = Math.max(...Object.values(months));
    monthBars = Object.entries(months).slice(-6).map(([k,v])=>bar(k,v,Math.max(1,maxMonth))).join('');
  }
  wrap.innerHTML = `<div style="display:flex;align-items:center;gap:14px;margin-bottom:14px"><div style="width:120px;height:120px;border-radius:50%;background:conic-gradient(var(--accent) ${sat}%, #f0ede6 0);display:grid;place-items:center;position:relative"><div style="position:absolute;inset:14px;border-radius:50%;background:var(--surface)"></div><div style="position:relative;font-weight:900;color:var(--accent)">${sat}%</div></div><div style="color:var(--text-light)">customers like the product quality</div></div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
    <div style="border:1px solid var(--border);border-radius:12px;background:var(--surface);padding:16px">
      <div style="font-weight:900;margin-bottom:8px">Feedback by Category</div>${cats}
    </div>
    <div style="border:1px solid var(--border);border-radius:12px;background:var(--surface);padding:16px">
      <div style="font-weight:900;margin-bottom:8px">Ratings Distribution</div>${rates}
    </div>
  </div>
  <div style="margin-top:24px;border:1px solid var(--border);border-radius:12px;background:var(--surface);padding:16px">
    <div style="font-weight:900;margin-bottom:8px">Monthly Feedback (last 6 months)</div>
    ${monthBars || '<div style="color:var(--text-light)">No monthly data</div>'}
  </div>`;
}
async function render(){
  const wrap = document.getElementById('tableWrap');
  let data = current==='contacts'? getData(CONTACT_KEY): getData(FEEDBACK_KEY);
  if(Backend.enabled()){
    let remote = null;
    if(current==='contacts'){
      remote = await Backend.get('/api/admin/leads');
      if(!remote) remote = await Backend.get('/api/leads');
    }else{
      remote = await Backend.get('/api/feedback');
    }
    if(Array.isArray(remote) && remote.length) data = remote;
  }
  if(!data.length){
    wrap.innerHTML = `<div class="empty">No ${current} records found.</div>`;
    drawCharts();
    return;
  }
  const cols = Object.keys(data[0]);
  const head = cols.map(c=>`<th>${c}</th>`).join('');
  const rows = data.map(row=>`<tr>${cols.map(c=>`<td>${row[c]}</td>`).join('')}</tr>`).join('');
  wrap.innerHTML = `<table class="table"><thead><tr>${head}</tr></thead><tbody>${rows}</tbody></table>`;
  drawCharts();
}
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    current = t.dataset.tab;
    render();
  });
});
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = current==='contacts'? getData(CONTACT_KEY): getData(FEEDBACK_KEY);
  if(!data.length) return;
  const csv = toCSV(data);
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const stamp = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
  a.href = url;
  a.download = `bmc-${current}-${stamp}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
});
document.getElementById('clearBtn').addEventListener('click', ()=>{
  if(current==='contacts') localStorage.removeItem(CONTACT_KEY);
  else localStorage.removeItem(FEEDBACK_KEY);
  render();
});
gate(); render();
(()=>{const k='bmc_theme';const cur=localStorage.getItem(k)||'light';document.documentElement.setAttribute('data-theme',cur);const b=document.getElementById('themeToggle');function txt(){return(localStorage.getItem(k)==='dark')?'Light Mode':'Dark Mode'}if(b){b.textContent=txt();b.addEventListener('click',()=>{const now=(localStorage.getItem(k)==='dark')?'light':'dark';localStorage.setItem(k,now);document.documentElement.setAttribute('data-theme',now);b.textContent=txt();});}})();
document.getElementById('backendStatus').textContent = Backend.enabled()? 'Backend: Connected' : 'Backend: Local';
window.addEventListener('scroll', ()=>{
  const n = document.querySelector('.main-nav');
  if(!n) return;
  if(window.scrollY>10) n.classList.add('scrolled'); else n.classList.remove('scrolled');
});
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem(ADM_KEY);
  if(Backend.enabled()){
    fetch(`${Backend.base}/api/admin/logout`, {method:'POST'}).catch(()=>{});
  }
  gate();
  window.scrollTo({top:0,behavior:'smooth'});
});
</script>
<style>
.fab-wrap{position:fixed;right:22px;bottom:22px;z-index:10000;display:flex;flex-direction:column;gap:10px}
.fab{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--accent);color:#fff;border:1px solid var(--accent-dark);box-shadow:0 10px 20px rgba(0,0,0,0.15);cursor:pointer;font-size:20px;position:relative}
.fab:hover{background:var(--accent-dark)}
.fab::after{content:attr(data-tip);position:absolute;right:58px;top:50%;transform:translateY(-50%);background:#2C1810;color:#F9F5EB;padding:6px 10px;border-radius:8px;font-size:12px;opacity:0;pointer-events:none;transition:opacity .2s}
.fab:hover::after{opacity:1}
.chat-window{position:fixed;right:22px;bottom:90px;width:300px;background:var(--surface);border:1px solid var(--border);border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.15);display:none;overflow:hidden}
.chat-head{padding:10px 12px;background:var(--text);color:var(--bg);font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:.06em}
.chat-body{padding:10px;max-height:260px;overflow:auto;font-size:14px;color:var(--text)}
.chat-msg{margin:6px 0;padding:8px 10px;border-radius:10px;background:#f4efe6}
.chat-input{display:flex;gap:6px;padding:10px;border-top:1px solid var(--border)}
.chat-input input{flex:1;padding:10px;border:1px solid var(--border);border-radius:8px}
.chat-input button{padding:10px 14px;border-radius:8px;border:1px solid var(--accent);background:var(--accent);color:#fff;font-weight:700;font-size:12px}
</style>
<div class="fab-wrap">
  <a class="fab" href="https://wa.me/919597512444" target="_blank" aria-label="WhatsApp" data-tip="Chat on WhatsApp">üü¢</a>
  <a class="fab" href="tel:+919597512444" aria-label="Call" data-tip="Call us">üìû</a>
  <a class="fab" href="mailto:mail@bestmarketingco.net" aria-label="Email" data-tip="Send Email">‚úâÔ∏è</a>
  <button class="fab" id="chatToggle" aria-label="Chatbot" data-tip="Chat with BMC">üí¨</button>
</div>
<div class="chat-window" id="chatWin">
  <div class="chat-head">BMC Chat</div>
  <div class="chat-body" id="chatBody">
    <div class="chat-msg">Hi! Admin tips: use export, clear with caution.</div>
  </div>
  <div class="chat-input">
    <input id="chatText" placeholder="Type a message..." />
    <button id="chatSend">Send</button>
  </div>
</div>
<style>
.float-btn{position:fixed;bottom:22px;display:flex;gap:10px;z-index:10001}
.float-btn a,.float-btn button{padding:10px 14px;border-radius:999px;border:1px solid var(--accent-dark);background:var(--accent);color:#fff;font-weight:700;font-size:12px;display:inline-flex;align-items:center;gap:8px}
.float-btn .left{left:22px}
.float-btn .right{right:22px}
.back-top{display:none}
</style>
<div class="float-btn left">
  <a href="bmc original maari.html#top">‚Üê Home</a>
  <button class="back-top" id="backTopBtn">‚Üë Top</button>
</div>
<script>
const chatWin = document.getElementById('chatWin');
document.getElementById('chatToggle').addEventListener('click', ()=>{
  chatWin.style.display = chatWin.style.display==='none' || chatWin.style.display==='' ? 'block' : 'none';
});
function reply(msg){
  const body = document.getElementById('chatBody');
  const add = (text)=>{ const d=document.createElement('div'); d.className='chat-msg'; d.textContent=text; body.appendChild(d); body.scrollTop = body.scrollHeight; };
  add(msg);
}
function handle(text){
  const t = text.toLowerCase();
  if(t.includes('export')) return 'Use Export CSV to download current tab data.';
  if(t.includes('clear')) return 'Clear removes records in the current tab only.';
  if(t.includes('contacts')||t.includes('feedback')) return 'Switch tabs to view Contacts or Feedback stored in localStorage.';
  if(t.includes('login')||t.includes('password')) return 'Authorized access required. Username: BMCAdmin, Password: BMC@2025.';
  if(t.includes('chart')||t.includes('visual')) return 'Feedback tab shows category and rating charts based on latest data.';
  return 'For issues, please contact mail@bestmarketingco.net.';
}
document.getElementById('chatSend').addEventListener('click', ()=>{
  const input = document.getElementById('chatText');
  const text = input.value.trim();
  if(!text) return;
  reply('You: ' + text);
  setTimeout(()=>reply('BMC: ' + handle(text)), 300);
  input.value='';
});
window.addEventListener('scroll', ()=>{
  const b = document.getElementById('backTopBtn');
  if(!b) return;
  b.style.display = window.scrollY > 200 ? 'inline-flex' : 'none';
});
document.getElementById('backTopBtn')?.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));
</script>
</div>
</body>
</html>
